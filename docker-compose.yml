###############################################################################
# SuperMega Mark 1 — Full AI Workspace Stack
#
# USAGE:
#   1. Copy .env.example to .env and fill in your API keys
#   2. Run: docker compose up -d
#   3. Open http://localhost:3000 for OpenHands (your Manus replacement)
#   4. Open http://localhost:5678 for n8n (workflow automation)
#   5. Open http://localhost:5173 for Bolt.diy (vibe coding)
#   6. Open http://localhost:3001 for Flowise (agent builder)
#
# REQUIREMENTS:
#   - Docker Desktop with 8GB+ RAM allocated
#   - A Gemini API key (free: https://aistudio.google.com/apikey)
#
# This replaces the old aspirational config with REAL services that work TODAY.
###############################################################################

services:
  # ─────────────────────────────────────────────────────────────────────────
  # 1. OpenHands — AI Software Engineer (THE Manus Replacement)
  #    http://localhost:3000
  #    ✅ Browser UI — give it a task, watch it code
  #    ✅ Computer use — controls browser, terminal, file system
  #    ✅ Sandbox — isolated Docker container per task
  #    ✅ 67.8K GitHub stars, actively maintained
  # ─────────────────────────────────────────────────────────────────────────
  openhands:
    image: ghcr.io/all-hands-ai/openhands:main
    container_name: mark1-openhands
    ports:
      - "3000:3000"
    environment:
      - SANDBOX_RUNTIME_CONTAINER_IMAGE=ghcr.io/all-hands-ai/runtime:main
      - LLM_MODEL=gemini/gemini-2.5-flash
      - LLM_API_KEY=${GEMINI_API_KEY}
      - LLM_BASE_URL=https://generativelanguage.googleapis.com/v1beta/openai
      - WORKSPACE_MOUNT_PATH=/opt/workspace
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - openhands-workspace:/opt/workspace
    restart: unless-stopped

  # ─────────────────────────────────────────────────────────────────────────
  # 2. n8n — Workflow Automation & Agent Orchestration
  #    http://localhost:5678
  #    ✅ Visual workflow builder — drag and drop
  #    ✅ 400+ integrations (Gmail, Drive, GitHub, Slack, etc.)
  #    ✅ AI Agent nodes — connect to any LLM
  #    ✅ 174K GitHub stars
  # ─────────────────────────────────────────────────────────────────────────
  n8n:
    image: n8nio/n8n:latest
    container_name: mark1-n8n
    ports:
      - "5678:5678"
    environment:
      - GENERIC_TIMEZONE=Asia/Yangon
      - N8N_SECURE_COOKIE=false
      - N8N_AI_ENABLED=true
    volumes:
      - n8n-data:/home/node/.n8n
    restart: unless-stopped

  # ─────────────────────────────────────────────────────────────────────────
  # 3. Bolt.diy — AI Coding in Browser (Vibe Coding)
  #    http://localhost:5173
  #    ✅ Full-stack app builder in browser
  #    ✅ Live preview and deploy
  #    ✅ Open source fork of Bolt.new
  #    ✅ 19K GitHub stars
  # ─────────────────────────────────────────────────────────────────────────
  bolt-diy:
    image: ghcr.io/stackblitz-labs/bolt.diy:latest
    container_name: mark1-bolt
    ports:
      - "5173:5173"
    environment:
      - GOOGLE_GENERATIVE_AI_API_KEY=${GEMINI_API_KEY}
      - DEFAULT_NUM_CTX=32768
    restart: unless-stopped

  # ─────────────────────────────────────────────────────────────────────────
  # 4. Flowise — Low-Code AI Agent Builder
  #    http://localhost:3001
  #    ✅ Drag-and-drop agent creation
  #    ✅ RAG pipelines, chatbots, tool chains
  #    ✅ Connect to any LLM provider
  # ─────────────────────────────────────────────────────────────────────────
  flowise:
    image: flowiseai/flowise:latest
    container_name: mark1-flowise
    ports:
      - "3001:3000"
    environment:
      - FLOWISE_USERNAME=admin
      - FLOWISE_PASSWORD=${FLOWISE_PASSWORD:-mark1admin}
    volumes:
      - flowise-data:/root/.flowise
    restart: unless-stopped

  # ─────────────────────────────────────────────────────────────────────────
  # 5. Qdrant — Vector Database (Agent Memory & RAG)
  #    API at http://localhost:6333, Dashboard at http://localhost:6333/dashboard
  #    ✅ Persistent memory for all agents
  #    ✅ Semantic search for documents
  # ─────────────────────────────────────────────────────────────────────────
  qdrant:
    image: qdrant/qdrant:latest
    container_name: mark1-qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant-data:/qdrant/storage
    restart: unless-stopped

  # ─────────────────────────────────────────────────────────────────────────
  # 6. Redis — Task Queue & Caching
  #    Used by n8n and agents for job coordination
  # ─────────────────────────────────────────────────────────────────────────
  redis:
    image: redis:7-alpine
    container_name: mark1-redis
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes
    volumes:
      - redis-data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 3

volumes:
  openhands-workspace:
  n8n-data:
  flowise-data:
  qdrant-data:
  redis-data:
